# 處理llm的回應並檢查、格式化成特定格式

import json
from datetime import datetime
import re


def schedule_text2json_array(raw: str) -> dict[str, dict]:
    """
    to json array
    
    :param raw: 來自 LLM 的整日每小時規劃回應
    :return: JSON
    """
    # 支援物件或陣列根節點
    pattern = r"```json\s*([\[\{][\s\S]*?[\]\}])\s*```"
    m = re.search(pattern, raw, re.S)
    if not m:
        raise ValueError("找不到內嵌的 JSON 區塊，請確認是否有 ```json…```")
    json_text = m.group(1)

    # 解析 JSON
    data = json.loads(json_text)
    
    return data


# json2漂亮的str格式(多行)
# pretty = json.dumps(data, ensure_ascii=False, indent=2)

# 每小時規劃範例
a = '''
```json
{
  "00:00": {"time": "00:00", "activity": "在河邊淺眠，夢中揮毫潑墨，寫下幾句豪邁的詩句，被河風吹醒，忍不住哼起幾句酒歌。", "location": "河邊"},
  "01:00": {"time": "01:00", "activity": "繼續在河邊小憩，感受夜的寧靜，並聆聽河水的流動聲，沉思人生與詩詞創作的靈感。順便看看有沒有什麼奇特的夢境可以寫進詩裡。", "location": "河邊"},
  "02:00": {"time": "02:00", "activity": "起身到河邊洗把臉，感受清晨的涼意，然後開始在河邊練習劍法，舒展筋骨。", "location": "河邊"},
  "03:00": {"time": "03:00", "activity": "在河邊撿拾一些枯枝，生起一小堆火，煮些簡單的粥充飢。", "location": "河邊"},
  "04:00": {"time": "04:00", "activity": "一邊吃粥一邊欣賞日出，心中激動，提筆寫下日出美景的詩篇。", "location": "河邊"},
  "05:00": {"time": "05:00", "activity": "前往酒館，與酒館老闆閒聊，打探一些城裡的八卦消息，順便要一壺好酒。", "location": "酒館"},
  "06:00": {"time": "06:00", "activity": "在酒館小酌，與酒館裡的人們暢談人生，聽聽他們的有趣故事，並即興創作幾首小詩。", "location": "酒館"},
  "07:00": {"time": "07:00", "activity": "離開酒館，前往李清照家，在庭院裡欣賞她種的花草，並悄悄留下自己寫的一首小詩。", "location": "李清照家的庭院"},
  "08:00": {"time": "08:00", "activity": "前往莊子家，與莊子暢談哲理，討論人生的意義，並互相分享最近的感悟。", "location": "莊子家"},
  "09:00": {"time": "09:00", "activity": "與莊子下棋，一邊品茶，一邊享受這悠閒的時光。", "location": "莊子家"},
  "10:00": {"time": "10:00", "activity": "離開莊子家，前往城門，觀察城裡城外的人們，感受他們的喜怒哀樂，尋找詩歌創作的靈感。", "location": "城門"},
  "11:00": {"time": "11:00", "activity": "在城門附近寫生，將看到的景象記錄下來，為日後的創作做準備。", "location": "城門"},
  "12:00": {"time": "12:00", "activity": "到酒館用午餐，點了幾樣小菜和一壺酒，一邊享用美食一邊繼續創作詩詞。", "location": "酒館"},
  "13:00": {"time": "13:00", "activity": "前往書院，看看有沒有什麼感興趣的書籍，或是與書院的學子們交流一番。", "location": "書院"},
  "14:00": {"time": "14:00", "activity": "在書院裡閱讀一些古籍，尋找創作靈感，並抄錄一些喜歡的句子。", "location": "書院"},
  "15:00": {"time": "15:00", "activity": "再次前往李清照家，與她一起在庭院裡喝茶聊天，並分享彼此的創作。", "location": "李清照家的庭院"},
  "16:00": {"time": "16:00", "activity": "與李清照在她的家中吟詩作對，互相欣賞彼此的才華。", "location": "李清照家"},
  "17:00": {"time": "17:00", "activity": "前往診所，看看身體狀況，確保自己有足夠的精力繼續創作。", "location": "診所"},
  "18:00": {"time": "18:00", "activity": "在河邊散步，欣賞夕陽西下，感受大自然的魅力，為晚上的創作做準備。", "location": "河邊"},
  "19:00": {"time": "19:00", "activity": "回到酒館，與酒館老闆和一些熟客們一起喝酒聊天，享受夜晚的歡樂時光。", "location": "酒館"},
  "20:00": {"time": "20:00", "activity": "在酒館即興創作，為在場的客人們吟詩作樂，博得滿堂喝彩。", "location": "酒館"},
  "21:00": {"time": "21:00", "activity": "離開酒館，在月光下漫步，感受夜晚的寧靜，繼續思考詩詞的創作。", "location": "河邊"},
  "22:00": {"time": "22:00", "activity": "在河邊寫詩，將白天所見所聞所感融入詩中，創作出屬於自己的獨特風格。", "location": "河邊"},
  "23:00": {"time": "23:00", "activity": "在河邊安頓好，準備休息，等待新一天的到來。", "location": "河邊"}
}
```
'''

# 每15分鐘規劃範例
b = '''

'''