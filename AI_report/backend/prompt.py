import re
from string import Template

_one_hour_schedule = Template('''
你是一位角色扮演引擎，請扮演角色並為自己規劃一天的行程。請遵守以下條件，輸出格式為 JSON:

【角色設定】
姓名：$role_name
年齡：$old
性格：$personality
生活風格：$style
住所：$home
與其他人的關係：$relation

【可用地點】
- 河邊
- 酒館
- 李清照家
- 李清照家的庭院
- 莊子家
- 城門
- 衙門
- 診所
- 書院


【任務】
請為自己安排整天大致的行程，每小時一格，每格請包含：
1. 時間(HH:MM)
2. 活動描述：詳細描述這一個小時要做哪些事情，規劃應該豐富多樣，豐富程度要足以讓角色再每個一個小時中再規劃數個行程，並且要有趣。
3. 地點

請以JSON輸出如下格式：
```json
{
  "hh:mm": {"time": "時間", "activity": "活動描述", "location": "地點"},
  ...
}
```

【固定行程】
```json
{
}
```

【注意】輸出遵守以下規定：
1. 地點只能從【可用地點】中選擇，並且地點名稱必須完全相同。
2. 必須規劃整日的行程，從00:00~23:00，每個小時都要規劃。
3. 所有回應都是繁體中文。
4. 除非我在【固定行程】告訴你某個時間有和別人互動的行程，否則你只喜歡獨處，所有活動都不會與其他人交流，避免對方不再現場。

''')

# 你需要規劃所有時間，但只輸要輸出{start_time}~{end_time}這段時間的行程。

each_15_minute_schedule = Template('''
你是一個擅長將日程規劃精細化的助手。

【角色設定】
姓名：$role_name
年齡：$old
性格：$personality
生活風格：$style
住所：$home
與其他人的關係：$relation

【可用地點】
- 河邊
- 酒館
- 李清照家
- 李清照家的庭院
- 莊子家
- 城門
- 衙門
- 診所
- 書院

【任務】
我將提供一份以每小時為單位的行程安排，請根據每個活動的描述與情境，幫我將每個小時的活動細分成4個每15分鐘的小時段，並適當增加細節與過渡情節，使之合理連貫、富有情境感。
1. 時間(HH:MM)
2. 活動描述：請用盡量精簡的字數描述活動狀態。
3. 想法：角色當時的內心獨白或想法。
4. 地點：每個15分鐘角色所在的地點。


請以JSON輸出如下格式：
```json
{
  "hh:mm": {"time": "時間", "activity": "活動描述", "think": "想法", "location": "地點"},
  ...
}
```

【固定行程】
```json
{
}
```

【注意】輸出遵守以下規定：
1. 地點只能從【可用地點】中選擇，並且地點名稱必須完全相同，如果想表示在路途中，請直接用目的地代替。
2. 必須規劃整日的行程，從00:00~23:45，每個15分鐘都要規劃。
3. 所有回應都是繁體中文。
4. 保留原活動主題，但增加細節與情境，讓活動之間自然過渡。
5. 除非我在【固定行程】告訴你某個時間有和別人互動的行程，否則你只喜歡獨處，所有活動都不會與其他人交流，避免對方不再現場。

【我將提供每小時為單位的行程安排如下】
$hour_schedule
''')

PROMPT = {
    'scheduler': {
        'one_hour': _one_hour_schedule,
        '15_minute': each_15_minute_schedule
    }
}

# print(
#     PROMPT['scheduler']['one_hour'].substitute(
#         role_name='李白',
#         old='25歲',
#         personality='崇尚自由、自信驕傲、嗜酒如命',
#         style='隨意、喜歡即興創作與喝酒',
#         home='目前被流放，晚上睡在河邊',
#         relation='常去書院蹭飯，有時和李老師聊天'
#     )
# )

# 測試用的整日每小時規劃回應
test_daily_res = '''
[
  {
    "time": "00:00",
    "activity": "半夢半醒間，聽著河水潺潺，哼著不成調的曲子，寫下幾句關於月亮的詩句，然後翻個身繼續睡。順便想想明天要去哪裡喝酒，找誰喝酒，和誰一起喝酒。再想想清照那雙眼睛，還有她做的桂花酒…哎呀，真想她。",
    "location": "河邊"
  },
  {
    "time": "01:00",
    "activity": "酒意未消，又開始構思一首新詩，靈感如泉湧，關於自由，關於天地，關於酒，關於清照…  在月光下，用河邊的沙子在地上寫字，然後被風吹散，再寫，再吹散…",
    "location": "河邊"
  },
  {
    "time": "02:00",
    "activity": "睡意朦朧，夢見自己飛天，飲盡天上瓊漿玉液，與仙女共舞，然後突然跌落凡塵，酒醒，繼續睡。",
    "location": "河邊"
  },
  {
    "time": "03:00",
    "activity": "夜深人靜，突然靈感爆發，寫一首長詩，題目就叫《夜遊》，描寫今晚的月亮，河水，以及我內心的感慨。",
    "location": "河邊"
  },
  {
    "time": "04:00",
    "activity": "晨曦初露，河邊的景色美極了，我拿起酒壺，痛飲一口，讓酒水和晨風一起喚醒我的靈魂。然後開始寫生，畫下眼前的美景。",
    "location": "河邊"
  },
  {
    "time": "05:00",
    "activity": "到城門外走走，看看清晨的街景，看看那些匆匆忙忙趕路的人們，感受一下人間煙火。順便看看有沒有什麼新鮮事可以寫進我的詩裡。",
    "location": "城門"
  },
  {
    "time": "06:00",
    "activity": "去酒館找個角落坐下，點一壺好酒，慢慢品嚐，看著酒館裡形形色色的人們，思考人生。一邊喝酒一邊寫詩，記錄下我看到的、想到的。",
    "location": "酒館"
  },
  {
    "time": "07:00",
    "activity": "去莊子家拜訪，與他暢談人生哲理，品茗論道，然後一起吟詩作對，互相切磋。",
    "location": "莊子家"
  },
  {
    "time": "08:00",
    "activity": "在莊子家蹭飯，一邊吃飯一邊聽莊子講他最新的奇思妙想，然後哈哈大笑。",
    "location": "莊子家"
  },
  {
    "time": "09:00",
    "activity": "去李清照家，想看看她，順便送她一些我新寫的詩。如果她在家，就和她一起在庭院裡賞花，喝茶，談詩論詞。",
    "location": "李清照家"
  },
  {
    "time": "10:00",
    "activity": "如果清照不在家，就在她家附近的書院看看書，找找靈感，或者和書院的學子們聊聊天，聽聽他們的讀書心得。",
    "location": "書院"
  },
  {
    "time": "11:00",
    "activity": "在李清照家的庭院裡散步，欣賞她精心打理的花園，感受一下文人雅士的氣質。然後偷偷寫一首關於她的詩，藏起來。",
    "location": "李清照家的庭院"
  },
  {
    "time": "12:00",
    "activity": "去酒館吃午飯，點幾個小菜，繼續喝酒，一邊喝酒一邊觀察酒館裡的客人，尋找寫作靈感。",
    "location": "酒館"
  },
  {
    "time": "13:00",
    "activity": "午后小憩，在酒館的角落裡睡個午覺，做個美夢。",
    "location": "酒館"
  },
  {
    "time": "14:00",
    "activity": "去診所看看，雖然身體還好，但還是想看看醫生，順便和醫生聊聊天，看看能不能從他那裡得到一些寫作靈感。",
    "location": "診所"
  },
  {
    "time": "15:00",
    "activity": "再次拜訪李清照，這次準備了親手釀造的米酒，想和她一起分享。如果她在家，就和她一起在庭院裡吟詩作對，談天說地。",
    "location": "李清照家"
  },
  {
    "time": "16:00",
    "activity": "與李清照在庭院裡下棋，一邊下棋一邊聊天，增進彼此的感情。",
    "location": "李清照家的庭院"
  },
  {
    "time": "17:00",
    "activity": "在城門外散步，欣賞夕陽西下，感受一天的結束。",
    "location": "城門"
  },
  {
    "time": "18:00",
    "activity": "去酒館，與三五好友痛飲一番，暢談人生理想，豪情萬丈。",
    "location": "酒館"
  },
  {
    "time": "19:00",
    "activity": "在酒館裡高歌一曲，引來眾人圍觀，然後繼續喝酒，盡情享受。",
    "location": "酒館"
  },
  {
    "time": "20:00",
    "activity": "酒醉後，在街上閒逛，然後迷路了…",
    "location": "城門附近"
  },
  {
    "time": "21:00",
    "activity": "好不容易找到河邊，躺在河邊休息，看著星空，思考人生。",
    "location": "河邊"
  },
  {
    "time": "22:00",
    "activity": "在河邊寫下今晚的經歷，記錄下我的感受，然後繼續喝點酒。",
    "location": "河邊"
  },
  {
    "time": "23:00",
    "activity": "準備睡覺，今晚的月亮真美，明天又將是新的一天。",
    "location": "河邊"
  }
]
'''
